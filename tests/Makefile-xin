LIB     = ../src/libH2Pack.a #$(VTUNE_AMPLIFIER_2018_DIR)/lib64/libittnotify.a
INC     = -I../src/include   #-I$(VTUNE_AMPLIFIER_2018_DIR)/include

USE_MKL      = 0
USE_OPENBLAS = 1
#OPENBLAS_INSTALL_DIR = /home/mkurisu/Workspace/OpenBLAS-0.3.8/install
OPENBLAS_INSTALL_DIR = /usr/local/opt/openblas

CC      = gcc
DEF     = -DUSE_AVX
CFLAGS  = $(INC) -Wall -g -std=gnu99 -O3 $(DEF)
LDFLAGS = -g -O3

ifeq ($(CC), icc)
CFLAGS  += -qopenmp -xHost
endif

ifeq ($(CC), gcc)
CFLAGS  += -fopenmp -march=native -Wno-unused-result -Wno-unused-function
endif

ifeq ($(USE_MKL), 1)
DEF     += -DUSE_MKL
CFLAGS  += -mkl
LDFLAGS += -mkl -qopenmp
endif

ifeq ($(USE_OPENBLAS), 1)
DEF     += -DUSE_OPENBLAS
LIB     += $(OPENBLAS_INSTALL_DIR)/lib/libopenblas.a
INC     += -I$(OPENBLAS_INSTALL_DIR)/include
LDFLAGS += -fopenmp -lm
endif

SRCS = $(wildcard *.c)
OBJS = $(SRCS:.c=.o)
EXES = $(OBJS:.o=.exe)

all: $(EXES)

%.o: %.c
	$(CC) $(CFLAGS) -I../ -c $^ 
	
%.exe: %.o $(LIB)
	$(CC) -o $@ $^ $(LDFLAGS) 
	
clean:
	rm -f $(EXES) $(OBJS)
